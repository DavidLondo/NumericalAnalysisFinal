{% extends 'base.html' %} {% block title %}Métodos Iterativos{% endblock %} {%
block content %}
<style>
  .contenedor {
    display: flex;
    gap: 2rem;
    margin-top: 2rem;
  }

  .botones {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .botones button {
    padding: 0.5rem 1rem;
    cursor: pointer;
    border: 1px solid #888;
    background-color: #f0f0f0;
    border-radius: 4px;
  }

  .area-metodo {
    flex-grow: 1;
    border: 1px solid #ccc;
    padding: 1rem;
    border-radius: 6px;
    min-width: 300px;
  }

  .metodo-formulario {
    display: none;
  }

  .metodo-formulario.activo {
    display: block;
  }
</style>

<h2>Capítulo 1 – Selecciona un método iterativo</h2>

<div class="contenedor">
  <div class="botones">
    <button onclick="mostrarFormulario('biseccion')">Bisección</button>
    <button onclick="mostrarFormulario('reglafalsa')">Regla Falsa</button>
    <button onclick="mostrarFormulario('puntofijo')">Punto Fijo</button>
    <button onclick="mostrarFormulario('newton')">Newton</button>
    <button onclick="mostrarFormulario('secante')">Secante</button>
    <button onclick="mostrarFormulario('raicesmultiples')">
      Raíces Múltiples
    </button>
  </div>

  <div class="area-metodo">
    {% if resultados_comparativos %}
    <h2>Informe Comparativo de Métodos</h2>
    <table border="1">
      <thead>
        <tr>
          <th>Método</th>
          <th>Raíz aproximada</th>
          <th>Iteraciones</th>
          <th>Error final</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>
        {% for metodo, datos in resultados_comparativos.items() %}
        <tr>
          <td>{{ metodo }}</td>
          <td>
            {% if 'solucion' in datos %} {{ datos.solucion|round(6) }} {% else
            %} - {% endif %}
          </td>
          <td>
            {% if 'iteraciones' in datos %} {{ datos.iteraciones }} {% else %} -
            {% endif %}
          </td>
          <td>
            {% if 'error_final' in datos and datos.error_final is not none %} {{
            datos.error_final|round(6) }} {% else %} - {% endif %}
          </td>
          <td>
            {% if 'error' in datos %} {{ datos.error }} {% else %} Éxito {%
            endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <p><strong>Mejor método:</strong> {{ mejor_metodo }}</p>
    {% endif %}
    <div
      id="biseccion"
      class="metodo-formulario {% if metodo_actual == 'biseccion' %}activo{% endif %}"
    >
      <h3>Bisección</h3>
      <form method="post">
        <input type="hidden" name="metodo" value="biseccion" />
        <input type="text" name="f_biseccion" placeholder="f(x)" required />
        <input type="text" name="a" placeholder="a" required />
        <input type="text" name="b" placeholder="b" required />
        <input
        type="text"
        name="tol"
        placeholder="Tolerancia (ej: 0.001)"
        required
        />
        <input type="text" name="iter" placeholder="Máximo de iteraciónes" required/>
        <div>
          <label>
            <input
              type="checkbox"
              name="informe_comparativo"
              {%
              if
              informe_comparativo
              %}checked{%
              endif
              %}
            />
            Mostrar informe comparativo
          </label>
        </div>
        <button type="submit">Calcular</button>
      </form>

      {% if resultado_biseccion %}
      <h4>Resultado: {{ resultado_biseccion['resultado'] }}</h4>
      <table border="1">
        <tr>
          <th>Iteración</th>
          <th>xi</th>
          <th>f(xi)</th>
          <th>Error</th>
        </tr>
        {% for fila in resultado_biseccion['iteraciones'] %}
        <tr>
          <td>{{ fila.iter }}</td>
          <td>{{ fila.xi }}</td>
          <td>{{ fila.f_xi }}</td>
          <td>{{ fila.error if fila.error is not none else '---' }}</td>
        </tr>
        {% endfor %}
      </table>
      {% elif error_biseccion %}
      <p style="color: red">{{ error_biseccion }}</p>
      {% endif %} {% if resultado_biseccion.grafica_base64 %}
      <h3>Gráfica:</h3>
      <img
        src="data:image/png;base64,{{ resultado_biseccion.grafica_base64 }}"
        alt="Gráfica de la función"
      />
      {% endif %}
    </div>

    <div
      id="reglafalsa"
      class="metodo-formulario {% if metodo_actual == 'reglafalsa' %}activo{% endif %}"
    >
      <h3>Regla Falsa</h3>
      <form method="post">
        <input type="hidden" name="metodo" value="reglafalsa" />
        <input type="text" name="f_reglafalsa" placeholder="f(x)" required/>
        <input type="text" name="a" placeholder="a" required/>
        <input type="text" name="b" placeholder="b" required/>
        <input type="text" name="tol" placeholder="Tolerancia (ej: 0.001)" required/>
        <input type="text" name="iter" placeholder="Máximo de iteraciónes" required/>
        <div>
          <label>
            <input
              type="checkbox"
              name="informe_comparativo"
              {%
              if
              informe_comparativo
              %}checked{%
              endif
              %}
            />
            Mostrar informe comparativo
          </label>
        </div>
        <button type="submit">Calcular</button>
      </form>

      {% if resultado_reglafalsa %}
      <h4>Resultado: {{ resultado_reglafalsa['resultado'] }}</h4>
      <table border="1" style="border-collapse: collapse; width: 100%">
        <thead>
          <tr>
            <th>Iteración</th>
            <th>a</th>
            <th>b</th>
            <th>c</th>
            <th>f(a)</th>
            <th>f(b)</th>
            <th>f(c)</th>
            <th>Error</th>
          </tr>
        </thead>
        <tbody>
          {% for fila in resultado_reglafalsa['iteraciones'] %}
          <tr>
            <td>{{ fila.iter }}</td>
            <td>{{ '%.6f'|format(fila.a) }}</td>
            <td>{{ '%.6f'|format(fila.b) }}</td>
            <td>{{ '%.6f'|format(fila.c) }}</td>
            <td>{{ '%.6f'|format(fila.f_a) }}</td>
            <td>{{ '%.6f'|format(fila.f_b) }}</td>
            <td>{{ '%.6f'|format(fila.f_c) }}</td>
            <td>{{ fila.error if fila.error is not none else '---' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% elif error_reglafalsa %}
      <p style="color: red">{{ error_reglafalsa }}</p>
      {% endif %} {% if resultado_reglafalsa.grafica_base64 %}
      <h3>Gráfica de f(c):</h3>
      <img
        src="data:image/png;base64,{{ resultado_reglafalsa.grafica_base64 }}"
        alt="Gráfica Regla Falsa"
      />
      {% endif %}
    </div>

    <div
      id="puntofijo"
      class="metodo-formulario {% if metodo_actual == 'puntofijo' %}activo{% endif %}"
    >
      <h3>Punto Fijo</h3>
      <form method="post">
        <input type="hidden" name="metodo" value="puntofijo" />
        <input type="text" name="g_puntofijo" placeholder="g(x)" required/>
        <input type="text" name="x0" placeholder="x0" required/>
        <input type="text" name="tol" placeholder="Tolerancia (ej: 0.001)" required/>
        <input type="text" name="iter" placeholder="Máximo de iteraciónes" required/>
        <div>
          <label>
            <input
              type="checkbox"
              name="informe_comparativo"
              {%
              if
              informe_comparativo
              %}checked{%
              endif
              %}
            />
            Mostrar informe comparativo
          </label>
        </div>
        <button type="submit">Calcular</button>
      </form>

      {% if resultado_puntofijo %}
      <h4>Resultado: {{ resultado_puntofijo['resultado'] }}</h4>
      <table border="1" style="border-collapse: collapse; width: 100%">
        <thead>
          <tr>
            <th>Iteración</th>
            <th>Xi</th>
            <th>f(Xi)</th>
            <th>Error</th>
          </tr>
        </thead>
        <tbody>
          {% for fila in resultado_puntofijo['iteraciones'] %}
          <tr>
            <td>{{ fila.iter }}</td>
            <td>{{ '%.6f'|format(fila.xi) }}</td>
            <td>{{ '%.6f'|format(fila.f_xi) }}</td>
            <td>{{ fila.error if fila.error is not none else '---' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% elif error_puntofijo %}
      <p style="color: red">{{ error_puntofijo }}</p>
      {% endif %} {% if resultado_puntofijo.grafica_base64 %}
      <h3>Gráfica:</h3>
      <img
        src="data:image/png;base64,{{ resultado_puntofijo.grafica_base64 }}"
        alt="Gráfica Punto Fijo"
      />
      {% endif %}
    </div>

    <div
      id="newton"
      class="metodo-formulario {% if metodo_actual == 'newton' %}activo{% endif %}"
    >
      <h3>Newton</h3>
      <form method="post">
        <input type="hidden" name="metodo" value="newton" />
        <input type="text" name="f_newton" placeholder="f(x)" required/>
        <input type="text" name="x0" placeholder="x0" required/>
        <input type="text" name="tol" placeholder="Tolerancia (ej: 0.001)" required/>
        <input type="text" name="iter" placeholder="Máximo de iteraciónes" required/>
        <div>
          <label>
            <input
              type="checkbox"
              name="informe_comparativo"
              {%
              if
              informe_comparativo
              %}checked{%
              endif
              %}
            />
            Mostrar informe comparativo
          </label>
        </div>
        <button type="submit">Calcular</button>
      </form>

      {% if resultado_newton %}
      <h4>Resultado: {{ resultado_newton['resultado'] }}</h4>
      <table border="1" style="border-collapse: collapse; width: 100%">
        <thead>
          <tr>
            <th>Iteración</th>
            <th>Xi</th>
            <th>f(Xi)</th>
            <th>Error</th>
          </tr>
        </thead>
        <tbody>
          {% for fila in resultado_newton['iteraciones'] %}
          <tr>
            <td>{{ fila.iter }}</td>
            <td>{{ '%.6f'|format(fila.xi) }}</td>
            <td>{{ '%.6f'|format(fila.f_xi) }}</td>
            <td>{{ fila.error if fila.error is not none else '---' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% elif error_newton %}
      <p style="color: red">{{ error_newton }}</p>
      {% endif %} {% if resultado_newton.grafica_base64 %}
      <h3>Gráfica:</h3>
      <img
        src="data:image/png;base64,{{ resultado_newton.grafica_base64 }}"
        alt="Gráfica Newton-Raphson"
      />
      {% endif %}
    </div>

    <div
      id="secante"
      class="metodo-formulario {% if metodo_actual == 'secante' %}activo{% endif %}"
    >
      <h3>Secante</h3>
      <form method="post">
        <input type="hidden" name="metodo" value="secante" />
        <input type="text" name="f_secante" placeholder="f(x)" required/>
        <input type="text" name="x0" placeholder="x0" required/>
        <input type="text" name="x1" placeholder="x1" required/>
        <input type="text" name="tol" placeholder="Tolerancia (ej: 0.001)" required/>
        <input type="text" name="iter" placeholder="Máximo de iteraciónes" required/>
        <div>
          <label>
            <input
              type="checkbox"
              name="informe_comparativo"
              {%
              if
              informe_comparativo
              %}checked{%
              endif
              %}
            />
            Mostrar informe comparativo
          </label>
        </div>
        <button type="submit">Calcular</button>
      </form>

      {% if resultado_secante %}
      <h4>Resultado: {{ resultado_secante['resultado'] }}</h4>
      <table border="1" style="border-collapse: collapse; width: 100%">
        <thead>
          <tr>
            <th>Iteración</th>
            <th>Xi</th>
            <th>f(Xi)</th>
            <th>Error</th>
          </tr>
        </thead>
        <tbody>
          {% for fila in resultado_secante['iteraciones'] %}
          <tr>
            <td>{{ fila.iter }}</td>
            <td>{{ '%.6f'|format(fila.Xi) }}</td>
            <td>{{ '%.6f'|format(fila.f_Xi) }}</td>
            <td>{{ fila.error if fila.error is not none else '---' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% elif error_secante %}
      <p style="color: red">{{ error_secante }}</p>
      {% endif %} {% if resultado_secante.grafica_base64 %}
      <h3>Gráfica de f(c):</h3>
      <img
        src="data:image/png;base64,{{ resultado_secante.grafica_base64 }}"
        alt="Gráfica Regla Falsa"
      />
      {% endif %}
    </div>

    <div
      id="raicesmultiples"
      class="metodo-formulario {% if metodo_actual == 'raicesmultiples' %}activo{% endif %}"
    >
      <h3>Raices Multiples</h3>
      <form method="post">
        <input type="hidden" name="metodo" value="raicesmultiples" />
        <input type="text" name="f_rm" placeholder="f(x)" required/>
        <input type="text" name="df_rm" placeholder="df(x)" required/>
        <input type="text" name="ddf_rm" placeholder="ddf(x)" required/>
        <input type="text" name="x0" placeholder="x0" required/>
        <input type="text" name="tol" placeholder="Tolerancia (ej: 0.001)" required/>
        <input type="text" name="iter" placeholder="Máximo de iteraciónes" required/>
        <div>
          <label>
            <input
              type="checkbox"
              name="informe_comparativo"
              {%
              if
              informe_comparativo
              %}checked{%
              endif
              %}
            />
            Mostrar informe comparativo
          </label>
        </div>
        <button type="submit">Calcular</button>
      </form>

      {% if resultado_raicesmultiples %}
      <h4>Resultado: {{ resultado_raicesmultiples['resultado'] }}</h4>
      <table border="1" style="border-collapse: collapse; width: 100%">
        <thead>
          <tr>
            <th>Iteración</th>
            <th>Xi</th>
            <th>f(Xi)</th>
            <th>Error</th>
          </tr>
        </thead>
        <tbody>
          {% for fila in resultado_raicesmultiples['iteraciones'] %}
          <tr>
            <td>{{ fila.iter }}</td>
            <td>{{ '%.6f'|format(fila.Xi) }}</td>
            <td>{{ '%.6f'|format(fila.f_Xi) }}</td>
            <td>{{ fila.error if fila.error is not none else '---' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% elif error_raicesmultiples %}
      <p style="color: red">{{ error_raicesmultiples }}</p>
      {% endif %} {% if resultado_raicesmultiples.grafica_base64 %}
      <h3>Gráfica:</h3>
      <img
        src="data:image/png;base64,{{ resultado_raicesmultiples.grafica_base64 }}"
        alt="Gráfica Raíces Múltiples"
      />
      {% endif %}
    </div>
  </div>
</div>

<script>
  function mostrarFormulario(id) {
    const formularios = document.querySelectorAll(".metodo-formulario");
    formularios.forEach((f) => f.classList.remove("activo"));
    document.getElementById(id).classList.add("activo");
  }
</script>
{% endblock %}
