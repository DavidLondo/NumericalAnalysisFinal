{% extends 'base.html' %}

{% block title %}Capítulo 3 – Interpolación{% endblock %}

{% block content %}
<style>
  .contenedor {
    display: flex;
    gap: 2rem;
    margin-top: 2rem;
  }

  .botones {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .botones button {
    padding: 0.5rem 1rem;
    cursor: pointer;
    border: 1px solid #888;
    background-color: #f0f0f0;
    border-radius: 4px;
  }

  .area-metodo {
    flex-grow: 1;
    border: 1px solid #ccc;
    padding: 1rem;
    border-radius: 6px;
    min-width: 300px;
  }

  .metodo-formulario {
    display: none;
  }

  .metodo-formulario.activo {
    display: block;
  }
</style>

<h2>Capítulo 3 – Selecciona un método</h2>

<div class="contenedor">
  <div class="botones">
    <button onclick="mostrarFormulario('vandermonde')">Vandermonde</button>
    <button onclick="mostrarFormulario('newtoninter')">Newton Interpolante</button>
    <button onclick="mostrarFormulario('lagrange')">Lagrange</button>
    <button onclick="mostrarFormulario('splinel')">Spline Lineal</button>
    <button onclick="mostrarFormulario('splinec')">Spline Cúbico</button>
  </div>

  <div class="area-metodo">
    <p>[3, 3.7, 4.4] - [6, 10, 15]</p>
    <p>4 - 12.0952</p>
    <!-- Informe -->
    {% if informe %}
      <h3>Informe Comparativo</h3>
      <table border="1">
        <thead>
            <tr>
                <th>Método</th>
                <th>Polinomio</th>
                <th>y estimado (x_real)</th>
                <th>Error absoluto</th>
            </tr>
        </thead>
        <tbody>
            {% for metodo, datos in informe.items() %}
            <tr>
                <td>{{ metodo }}</td>
                <td>{{ datos['solucion'] if 'solucion' in datos else datos['error'] }}</td>
                <td>{{ "%.6f"|format(datos['y_estimado']) if 'y_estimado' in datos else "N/A" }}</td>
                <td>{{ "%.6f"|format(datos['error_validacion']) if 'error_validacion' in datos else "N/A" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
      <p><strong>Mejor método:</strong> {{ mejor_metodo }}</p>
    {% endif %}

    <!-- VANDERMONDE -->
    <div id="vandermonde" class="metodo-formulario {% if metodo_actual == 'vandermonde' %}activo{% endif %}">
      <h3>Vandermonde</h3>
      <form method="post">
        <input type="hidden" name="metodo" value="vandermonde" />
        <textarea name="vector_x" placeholder="Vector x (ej: [3, 3.7, 4.4])" required rows="3" style="width:100%;"></textarea>
        <textarea name="vector_y" placeholder="Vector y (ej: [6, 10, 15])" required rows="3" style="width:100%;"></textarea>
        <button type="submit">Calcular</button>
        <input type="checkbox" name="generar_informe" class="check-informe"> Generar informe comparativo
        <div class="campos-informe" style="display: none; margin-top: 1rem;">
          <label for="x_real">x de validación:</label>
          <input type="text" name="x_real" class="input-x" placeholder="Ej: 4" required>

          <label for="y_real">y real (esperado):</label>
          <input type="text" name="y_real" class="input-y" placeholder="Ej: 12.0952" required>
        </div>
      </form>

      {% if resultado_vandermonde %}
      <h4>Resultado: {{ resultado_vandermonde['solucion'] }}</h4>
      <img src="data:image/png;base64,{{ resultado_vandermonde['grafica'] }}" alt="Gráfico del polinomio">
      {% elif error_vandermonde %}
      <p style="color: red">{{ error_vandermonde }}</p>
      {% endif %}
    </div>

    <!-- NEWTON INTERPOLANTE -->
    <div id="newtoninter" class="metodo-formulario {% if metodo_actual == 'newtoninter' %}activo{% endif %}">
      <h3>Newton Interpolante</h3>
      <form method="post">
        <input type="hidden" name="metodo" value="newtoninter" />
        <textarea name="vector_x" placeholder="Vector x (ej: [3, 3.7, 4.4])" required rows="3" style="width:100%;"></textarea>
        <textarea name="vector_y" placeholder="Vector y (ej: [6, 10, 15])" required rows="3" style="width:100%;"></textarea>
        <button type="submit">Calcular</button>
        <input type="checkbox" name="generar_informe" class="check-informe"> Generar informe comparativo
        <div class="campos-informe" style="display: none; margin-top: 1rem;">
          <label for="x_real">x de validación:</label>
          <input type="text" name="x_real" class="input-x" placeholder="Ej: 4" required>

          <label for="y_real">y real (esperado):</label>
          <input type="text" name="y_real" class="input-y" placeholder="Ej: 12.0952" required>
        </div>
      </form>

      {% if resultado_newton %}
      <h4>Resultado: {{ resultado_newton['solucion'] }}</h4>
      <h4>Tabla de diferencias divididas</h4>
      <table border="1">
        <tr>
          <th>i</th>
          <th>x_i</th>
          <th>f[x_i]</th>
          <th>Diferencias Divididas</th>
        </tr>
        {% for fila in resultado_newton['tabla'] %}
        <tr>
          <td>{{ fila[0] }}</td>
          <td>{{ fila[1] }}</td>
          <td>{{ fila[2] }}</td>
          <td>{{ fila[3] }}</td>
        </tr>
        {% endfor %}
      </table>
      <img src="data:image/png;base64,{{ resultado_newton['grafica'] }}" alt="Gráfico del polinomio">
      {% elif error_newton %}
      <p style="color: red">{{ error_newton }}</p>
      {% endif %}
    </div>

    <!-- LAGRANGE -->
    <div id="lagrange" class="metodo-formulario {% if metodo_actual == 'lagrange' %}activo{% endif %}">
      <h3>Lagrange</h3>
      <form method="post">
        <input type="hidden" name="metodo" value="lagrange" />
        <textarea name="vector_x" placeholder="Vector x (ej: [3, 3.7, 4.4])" required rows="3" style="width:100%;"></textarea>
        <textarea name="vector_y" placeholder="Vector y (ej: [6, 10, 15])" required rows="3" style="width:100%;"></textarea>
        <button type="submit">Calcular</button>
        <input type="checkbox" name="generar_informe" class="check-informe"> Generar informe comparativo
        <div class="campos-informe" style="display: none; margin-top: 1rem;">
          <label for="x_real">x de validación:</label>
          <input type="text" name="x_real" class="input-x" placeholder="Ej: 4" required>

          <label for="y_real">y real (esperado):</label>
          <input type="text" name="y_real" class="input-y" placeholder="Ej: 12.0952" required>
        </div>
      </form>

      {% if resultado_lagrange %}
      <h4>Resultado: {{ resultado_lagrange['solucion'] }}</h4>
      <img src="data:image/png;base64,{{ resultado_lagrange['grafica'] }}" alt="Gráfico del polinomio">
      {% elif error_lagrange %}
      <p style="color: red">{{ error_lagrange }}</p>
      {% endif %}
  </div>
</div>

<script>
  function mostrarFormulario(id) {
    const formularios = document.querySelectorAll(".metodo-formulario");
    formularios.forEach(f => f.classList.remove("activo"));
    document.getElementById(id).classList.add("activo");
  }

  document.addEventListener("DOMContentLoaded", function () {
    const checkboxes = document.querySelectorAll(".check-informe");

    checkboxes.forEach(function (checkbox) {
      checkbox.addEventListener("change", function () {
        const container = this.closest("form");
        const camposInforme = container.querySelector(".campos-informe");
        const inputs = camposInforme.querySelectorAll("input");

        if (this.checked) {
          camposInforme.style.display = "block";
          inputs.forEach(input => input.disabled = false);
        } else {
          camposInforme.style.display = "none";
          inputs.forEach(input => input.disabled = true);
        }
      });

      // Inicializa el estado al cargar
      checkbox.dispatchEvent(new Event('change'));
    });
  });
</script>
{% endblock %}
